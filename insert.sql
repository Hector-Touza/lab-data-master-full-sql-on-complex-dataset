// DML â€“ Limpieza y carga de datos
INSERT INTO S_ORDERS_TRANSFORMED
SELECT
  ID_ORDER,
  TRY_TO_DATE(DTE_ORDER, 'YYYY-MM-DD'),
  ID_CUSTOMER,
  CASE WHEN ID_PART != 'ERROR' THEN ID_PART ELSE NULL END,
  CASE 
    WHEN TRY_TO_NUMBER(QTY_ORDERED) IS NOT NULL AND TRY_TO_NUMBER(QTY_ORDERED) > 0 THEN TRY_TO_NUMBER(QTY_ORDERED)
    ELSE NULL
  END,
  TRY_TO_NUMBER(AMT_TOTAL),
  NULLIF(UPPER(REF_PAYMENT_METHOD), ''),
  TRY_TO_DATE(DTE_DELIVERY_EST, 'YYYY-MM-DD'),
  DES_ORDER_NOTE,
  NULLIF(CAT_ORDER_TYPE, ''),
  NULLIF(TYP_CUSTOMER_SEGMENT, ''),
  CASE WHEN REF_DISCOUNT_CODE IN ('SUMMER20', 'BLACKFRIDAY') THEN REF_DISCOUNT_CODE ELSE NULL END,
  CASE WHEN TRY_TO_NUMBER(QTY_UNITS_BACKORDER) IS NOT NULL THEN TRY_TO_NUMBER(QTY_UNITS_BACKORDER) ELSE NULL END,
  TRY_TO_TIMESTAMP(TST_INSERTION),
  AUD_USR_INSERT
FROM B_ORDERS_RAW_COMPLEX_WIDE;
